---
title: "Exercise 4: Basic Geoprocessing Tools <br><small>Geographic Information Systems 1 Lab</small></br>"
author: "GEOG 3150"
output:
  html_notebook:
    df_print: paged
    rows.print: 10
    theme: cosmo
    highlight: breezedark
    number_sections: yes
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: yes
  pdf_document: default
  html_document:
    toc: yes
    df_print: paged
editor_options:
  chunk_output_type: inline
  mode: gfm
---

```{=html}
<style type="text/css">

h1.title {
  font-size: 40px;
  font-family: "Times New Roman", Times, serif;
  color: DarkBlue;
  text-align: center;
}
h4.author { /* Header 4 - and the author and data headers use this too  */
  font-size: 20px;
  font-family: "Times New Roman", Times, serif;
  color: DarkBlue;
  text-align: center;
}

.zoom {
  transform-origin: 40% 50% 0;
  transition: transform .2s;
  margin: 0 auto;
}
.zoom img{
	width:auto;
	height:auto;	
}
.zoom:hover {
  transform: scale(2);
}

th, td {padding: 5px;}

</style>
```
<hr></hr>

The purpose of this exercise is to help familiarize you with some of the Geoprocessing Tools available in the various programs. These tools will help you to simplify, organize, and reduce the amount of information and allow you to create additional base maps from existing data.

# The Introduction

The _Federal Emergency Management Agency_&nbsp; (FEMA) is in the process of planning for the federal distribution of resources related to natural disasters in the US. As [hurricane](https://www.noaa.gov/news-release/noaa-predicts-another-active-atlantic-hurricane-season) season approaches predictions are suggesting a very active season in the Atlantic Basin. As a FEMA analyst, you have been tasked with examining hurricane paths over the last five years that have impacted the Southeastern US. This information will be used to develop a plan for the establishment of temporary relief shelters, supply storage facilities, and mobile medical services that will be necessary in the hardest hit areas.

In this exercise you will:

-   Use various methods of geoprocessing
-   Create derived datasets
-   Adjust the coordinate systems
-   Create inset maps
-   Use the attribute table for labeling

Software specific directions can be found for each step below. Please submit the answer to the questions and your final map by the due date.

## Step One: The Data

The data you will be using for this exercise comes from the National Oceanic and Atmospheric Administration - [Office for Coastal Management](https://coast.noaa.gov/), [Historical Hurricane Tracks interactive map](https://coast.noaa.gov/hurricanes/). Information on the site is derived from the NOAA National Hurricane Center [HURDAT2](https://www.nhc.noaa.gov/data/#hurdat) and NOAA National Centers for Environmental Information [IBTrACS](https://www.ncdc.noaa.gov/ibtracs/) data sets.

<details>
<summary><big>View Directions in <b> [ArcGIS Pro]{style="color:#ff4500"} </b></big></summary>

As you have done with each of the previous exercises, Exercise 2 and Exercise 3, you will begin by launching **[ArcGIS Pro]{style="color:#ff4500"}** from the start menu or dekstop shortcut. Select **Map** from _New > Blank Templates_ and on the resulting screen provide a name and location for your project. Remember it would be beneficial to keep all of these exercises in a single folder on your computer. 

With your screen now displaying the _World Topographic Map_&nbsp; and _World Hillshade_&nbsp; in the table of contents, navigate to GitHub and download **[all datasets for this exercise here](https://github.com/chrismgentry/GIS1-Exercise-4/tree/main/Data)** to your project folder and extract the data. If you have any questions on how to retrieve and extract the data refer to [Exercise 2, Step 1](https://chrismgentry.github.io/GIS1-Exercise-2/#11_Step_One:_The_Data) for detailed instructions.

Add the _states_, _counties_, and all _hurricanes_&nbsp; datasets to the map view. Remember that the layers in your _Table of Contents_&nbsp; are drawn in the order they appear. So the first item on the list will be the first show, followed, by the second and so on. Therefore, if you want certain datasets to be visible above all others it should be located at the top by clicking and dragging the data up or down in the list. For polygons, you can edit the fill and transparency (found under the appearance tab in effects) to allow for items underneath to be scene. For example, in the image below, the hurricane tracts are ordered by year and are situated on top of the county and state polygons. If the polygons were drawn first, the hurricane tracts would not be shown once they make landfall. In this example, the states polygons are displayed with a hollow fill and white border to allow for the counties to show through with their black borders.

<p align="center"><div class="zoom"><img src= "Images/arcgis-ex4-data.jpg" alt="Ex4 Datasets" style="width:100%"></div></p>

Refer back to previous exercises to review how to change the symbology for a given dataset. You should experiment with different order, fill, and transparencies to customize your view of the data.

Because FEMA is only interested in counties impacted by hurricanes, you need to select only the states that are intersected by the tracts. There are several ways to subset data in [ArcGIS Pro]{style="color:#ff4500"}. For this example we can select counties by name through a structured query language (SQL), we can use graphical tools to select data, and we can use geoprocessing tools to subset the data. Because this is a learning module, you will be learning several different techniques. While this might not necessarily be the quickest method, the purpose of this exercise is to introduce you to several tools you can use as appropriate in future projects. 

To continue gathering data for this exercise you are first going to isolate the data you want to select. In the _Table of Contents_ click the **List by Selection** button <img src= "Images/arcgis-list-selection-button.jpg" alt="List by Selection" width = "20" height = "20"> to show a list of the selectable datasets in the project. Because you should have a number of datasets in the project, to isolate only the states file, right-click on the _USA_States_Continental_&nbsp; and chose "Make this the only selectable layer". 

<p align="center"><div class="zoom"><img src= "Images/arcgis-make-selectable.png" alt="Make data selectable" style="width:100%"></div></p>

To begin, click the drop-down menu for _Select_&nbsp; on the _Map Tab_&nbsp; and choose **Lasso** from the drop-down menu and and use the cursor to draw a circle encompassing Alabama, Arkansas, Delaware, Florida, Georgia, Illinois, Indiana, Kentucky, Louisiana, Maryland, Mississippi, Missouri, New Jersey, North Carolina, Ohio, Pennsylvania, South Carolina, Tennessee, Virginia, and West Virginia. Your circle does not need to include all of the state, just a small portion. See the example below:

<p align="center"><div class="zoom"><img src= "Images/arcgis-lasso-select.png" alt="Lasso Select Tool" style="width:100%"></div></p>

With the states selected, return the Table of Contents to the "List by Drawing Order" button <img src= "Images/arcgis-list-draw-button.jpg" alt="List by Drawing Order" width = "20" height = "20"> and right-click on the _USA_States_Continental_&nbsp; dataset and choose **Data > Export Features** from the menu. In the resulting menu include the following options and click OK:

- _Input Features_ = USA_States_Continental
- _Output Location_ = Select a folder for the export. It it important that you do not click into the folder, simply click once to select and click OK (see example).
- _Output Name_ = choose a name for your file and add .shp behind it to create a shapefile.

<p align="center"><div class="zoom"><img src= "Images/arcgis-export-data.png" alt="Export Data" style="width:100%"></div></p>

When finished you should have the file added to your project. Another technique to isolate data is by using the **Clip** analysis tool. This tool can be used to cut out a piece of one dataset using one or more of the features in another dataset as a "cookie cutter". This is useful for creating a new dataset that contains a geographic subset of the features in another larger dataset.

<p align="center"><img src= "Images/arcgis-clip-illustration.png" alt="ArcGIS Pro Clip Illustration" width="515" height="202"><figcaption><small><b>Illustration from https://pro.arcgis.com/en/pro-app/latest/tool-reference/analysis/clip.htm</b></small></figcaption></p>

Under the _Analysis Tab_, click the **Tools** button <img src= "Images/arcgis-toolbox-button.jpg" alt="Geoprocessing Tools Button" width="20" height="20"> to open a geoprocessing search menu. In the search box at the top of the menu type in the word **Clip** and click enter. The first option will show "**Clip** (Analysis Tools)". Click on the tool to open the associated menu. In the new menu choose the following options from the drop-down menus and click Run :

- _Input Features_ = USA_Counties
- _Clip Features_ = ex4_States (or the name of the file for the selected states in the previous step)
- _Output Feature Class_ = choose a name for your file and add .shp behind it to create a shapefile.

<p align="center"><div class="zoom"><img src= "Images/arcgis-clip-tool.png" alt="Clip Analysis Tool" style="width:100%"></div></p>

This will create a dataset containing only the counties that are included within the states used as the selection. While the colors were altered to highlight the changes and additions to the project, you should now see a new dataset in your Table of Contents that only contains those counties. 

<p align="center"><div class="zoom"><img src= "Images/arcgis-clipped-data.png" alt="Clipped Counties" style="width:100%"></div><figcaption><small><b>Colors altered from previous images to highlight goeprocessing results.</b></small></figcaption></p>

Finally, while having the individual hurricane tracts can be important, for the purposes of this exercise you are going to use the **Merge** tool to combined all of the individual hurricane tracts into a single dataset. Similar to the previous step, click on the _Tools_&nbsp; button on the Analysis Tab and search for **Merge**. Click on "**Merge** (Data Management Tool)" and in the new window choose the following options from the drop-down menu and click run:

- _Input Datasets_ = Either from the drop-down menu or the _add many button_&nbsp; <img src= "Images/arcgis-add-many-button.jpg" alt="Add Many" width = "10" height = "10"> select all of the individual hurricane tracts. If using the "add many" button you will need to click the "add" link in the bottom right-hand corner of the input. If you use the drop-down menu the data will add automatically
- _Output Dataset_ = choose a name for your file and add .shp behind it to create a shapefile.

<p align="center"><div class="zoom"><img src= "Images/arcgis-merged-data.png" alt="Merged Hurricanes" style="width:100%"></div></p>

Now you can remove the _USA_Counties_&nbsp; and all the individual hurricane tract files to reduce the clutter in your Table of Contents. To do this you simply right-click on the dataset in the Table of Contents and click _Remove_.

<big><b>Question No. 1</b></big>
<blockquote>
How many individual tract segments are contained in the merged hurricane dataset?
</blockquote>

</details>
<hr></hr>

<details>
<summary><big>View directions in <b> [QGIS]{style="color: #006400"} </b></big></summary>

Blah...blah...blah...

<big><b>Question No. 1</b></big>
<blockquote>
_Insert Text Here_
</blockquote>

</details>
<hr></hr>

<details><summary><big>View directions in <b> [R]{style="color: #6495ED"} </b></span></big></summary>
Before you begin, you will need to open the [Ex2 Colab Notebook](https://github.com/chrismgentry/GIS1-Exercise-9/blob/main/GIS1_EX9.ipynb) and insert **tocolab** after _github_ in the URL to open in the _Colab Environment_. As you have seen before, R requires various packages to complete certain analyses. In this exercise you will be using **tidyverse, OpenStreetMaps, ggfortify, maptools, and rgeos**. To install and load the packages we will use the following script:

Blah...blah...blah...

<big><b>Question No. 1</b></big>
<blockquote>
_Insert Text Here_
</blockquote>

</details>

## Step Two: The Analyses

In this step you will organize and display the data in order to prepare it for the final visualization.

<details>
<summary><big>View Directions in <b> [ArcGIS Pro]{style="color:#ff4500"} </b></big></summary>

Now that you have the necessary data, you need determine which counties are most significantly impacted by the hurricanes. Because hurricane winds can impact areas far away from the eye or the storm, you will begin by creating a buffer around the hurricane tracts. You can either use the **Tools** button <img src= "Images/arcgis-toolbox-button.jpg" alt="Geoprocessing Tools Button" width="20" height="20"> on the _Analysis Tab_&nbsp; or search for **Buffer** in the list of tools next to the button. In the Buffer window select the following options and click run:

- _Input Features_ = The merged hurricane dataset
- _Output Feature Class_ = choose a name for your file and add .shp behind it to create a shapefile
- _Distance_ = 50 miles (linear unit)
- _Side Type_ = Full
- _End Type_ = Round
- _Method_ = Planar
- _Dissolve Type_ = Dissolve all output features into a single feature

<p align="center"><div class="zoom"><img src= "Images/arcgis-buffer-data.png" alt="Buffer Tool" style="width:100%"></div></p>

If in this step or the next you encounter a warning stating there is a "datum conflict between the input and output", just proceed with the exercise. We will discuss _datums_, a set of reference points on the earth's surface against which position measurements are made, in future exercises. While they are important to understand, for the purposes of this exercise you can ignore the warning.

In this next step you need to isolate only the counties that are located within this buffer. To do this, click the **Select By Location** button <img src= "Images/arcgis-select-location-button.jpg" alt="Select By Location Button" width="20" height="20"> on the _Map Tab_&nbsp; in the Selection Section. In the new menu choose the following and click OK.

- _Input Features_ = Your clipped counties
- _Relationship_ = Choose Intersect
- _Selecting Features_ = Your buffered hurricanes
- _Selection Type_ = New Selection

<p align="center"><div class="zoom"><img src= "Images/arcgis-select-by-location.png" alt="Select By Location" style="width:100%"></div></p>

With this selection made, you can take the same steps as before to create a new dataset by right-clicking on the clipped counties dataset in the Table of Contents, going to _Data > Export Features_&nbsp; and creating a new shapefile of the selected counties. You can now remove the clipped counties you created in step one or change the symbology to make this new selection stand out.

To answer the following question, open the attribute table for the new dataset you created highlighting the impacted counties. Right-click on the column header for the **Population** variable, and select statistics.

<big><b>Question No. 2</b></big>
<blockquote>
What is the total population (sum information) of the counties impacted by these hurricanes?
</blockquote>

</details>
<hr></hr>

<details>
<summary><big>View Directions in <b> [QGIS]{style="color:#006400"} </b></big></summary>

Blah...blah...blah...

<big><b>Question No. 2</b></big>
<blockquote>
_Insert Text Here_
</blockquote>

</details>
<hr></hr>

<details>
<summary><big>View Directions in <b> [R]{style="color:#6495ED"} </b></big></summary>

Blah...blah...blah...

<big><b>Question No. 2</b></big>
<blockquote>
_Insert Text Here_
</blockquote>

</details>

## Step Three: The Visualization

You will now create a graphical display of your data that includes cartographic elements such as legend, scale bar, north arrow, etc. In this visualization you will also learn to add a different basemap, add an inset or overview map, and alter the projected coordinate system. 

<details><summary><big>View directions in <b> [ArcGIS Pro]{style="color:#ff4500"} </b></span></big></summary>

On the _Map Tab_&nbsp; click the **Basemap** button <img src= "Images/arcgis-basemap-button.jpg" alt="Basemaps" width="20" height="20"> and select the option for _Oceans_. Remember that the order of the datasets in the Table of Contets determines what order they are displayed.

<p align="center"><div class="zoom"><img src= "Images/arcgis-basemaps.png" alt="Basemaps" style="width:100%"></div></p>

In future exercises you may choose any of these basemap options that are apprropriate for your analyses. Next, on the _Insert Tab_&nbsp; click the button for **New Map** <img src= "Images/arcgis-new-map-button.jpg" alt="Insert New Map" width="20" height="20"> and select New Map. A new map tab (probably called Map2) will appear in your map frame. Add (or copy/paste from the original map) the hurricane impacted counties and the continental US States shapefiles as well as the Oceans basemap to this new map. Be sure to zoom in a appropriate to see the data.

<p align="center"><img src= "Images/arcgis-map2.png" alt="Inset Map" style="width:100%"></p>

To return to the original map simply click on the appropriate tab. This will allow you to switch back and forth between the two in order to make the necessary customizations. It may be beneficial to rename each one to keep track of the purpose for each map.

Next you can change the projection of the coordinate system for the inset map (Map2). In the Table of Contents, right-click on **Map2** and select _Properties_. In the resulting window click **Coordinate Systems** from the left-side menu. Under "XY Coordinate Systems Available" scroll down until you see _Projected Coordinate System_. Using the series of drop-down menus go to **Projected Coordinate System > Continental > North America** and select the option for "North America Albers Equal Area Conic" and click OK. You should notice that the awkward "flat top" border of the United States should now me curved and the overall shape of the states has a more pleasing appearance.

<p align="center"><div class="zoom"><img src= "Images/arcgis-coordinate-systems.png" alt="Altering Coordinate systems" style="width:100%"></div></p>

In lecture we will discuss the importance of projections and coordinate systems. In future exercises you should take some time to select different options to see which _Coordinate System_&nbsp; has the most pleasing shape to your eyes.

It is now time for you to make your map. Similar to **[previous exercises](https://chrismgentry.github.io/GIS1-Exercise-2/#13_Step_Three:_The_Visualization)**, you need to add all of the necessary elements discussed in Exercise 2 and 3. In this exercise you will also need to add your inset map (Map2). To do this, you first need to add the primary map with using the Map Frame button like before. Next you can click the Map Frame button again to add the second map.

<p align="center"><div class="zoom"><img src= "Images/arcgis-add-map2.png" alt="Add Inset Map" style="width:100%"></div></p>

However, for the inset you want it to be smaller and not cover your map data.

<p align="center"><div class="zoom"><img src= "Images/arcgis-map-and-inset.png" alt="Map with Inset Map" style="width:100%"></div></p>

Finalize your map by adding all of the necessary map elements (title, legend, north arrow, scale bar, name and date) and altering the symbology of the hurricane dataset to provide additional important data. Remember to renaming items in the Table of Contents will rename them in the legend.

<p align="center"><img src= "Images/arcgis-final-map.png" alt="Final Map" style="width:100%"></p>

<big><b>Question No. 3</b></big>
<blockquote>
How many total impacted counties are included in the new dataset?
</blockquote>

</details>
<hr></hr>

<details><summary><big>View directions in <b> [QGIS]{style="color:#006400"} </b></span></big></summary>

Blah...blah...blah...

<big><b>Question No. 3</b></big>
<blockquote>
_Insert Text Here_
</blockquote>

</details>
<hr></hr>

<details><summary><big>View directions in <b> [R]{style="color:#6495ED"} </b></span></big></summary>

Blah...blah...blah...

<big><b>Question No. 3</b></big>
<blockquote>
_Insert Text Here_
</blockquote>

</details>

## Step Four: Your Turn

After providing the initial map to FEMA, the Deputy Associate Administrator for the Office of Response and Recovery has asked if you could add some additional data. Specifically, they are interested in cities with a population of greater than 300,000 so they are able to situate response teams in proximity to the most people.

<details><summary><big>View directions in <b> [ArcGIS Pro]{style="color:#ff4500"} </b></span></big></summary>

If you did not previously download the [cities data](https://github.com/chrismgentry/GIS1-Exercise-4/raw/main/Data/US_Cities_100k.zip) from the GitHub Exercise Page please download the data and unzip it in your project folder. With that data available, add the US_Cities_100k.shp to your primary map (not the inset map). Repeating the steps to **clip** from [Step 1](https://chrismgentry.github.io/GIS1-Exercise-4/#11_Step_One:_The_Data) select the cities as your _Input Feature_, the hurricane buffer as the _Clip Feature_, and be sure to save the new dataset to your project folder with .shp to create a shapefile.

While you will leave all of the clipped cities on the map, you will now create a _Label Class_ to only create labels for cities with a population greater than 300,000. To begin, right-click on your new clipped cities dataset and select "Labeling Properties..." <img src= "Images/arcgis-labeling-properties.jpg" alt="Labeling Properties" width="150" height="20"> from the options.

Under the "Class" option in the Label Class window select **SQL** from the three options. Next select _New expression_&nbsp; <img src= "Images/arcgis-new-expression-labels.jpg" alt="Labeling SQL" width="115" height="20"> and select the following options:

<p align="center">Where&emsp;**POPULATION**&emsp;**is greater than**&emsp;**300,000**</p>

<p align="center"><img src= "Images/arcgis-labeling-sql.png" alt="SQL Options for Labeling" style="width:75%"></p>

When complete, click **Apply** at the bottom of the window. Use the options on the _Labeling Tab_ for the dataset to adjust the label field to NAME, change the font or size of the text, and click the **Label** button on the left of the tab.

<p align="center"><div class="zoom"><img src= "Images/arcgis-labeling-tab.jpg" alt="Labeling Options" style="width:100%"></div></p>

<big><b>Question No. 4</b></big>
<blockquote>
_Insert Text Here_
</blockquote>

</details>
<hr></hr>

<details><summary><big>View directions in <b> [QGIS]{style="color:#006400"} </b></span></big></summary>

Blah...blah...blah...

<big><b>Question No. 4</b></big>
<blockquote>
_Insert Text Here_
</blockquote>

</details>
<hr></hr>

<details><summary><big>View directions in <b> [R]{style="color:#6495ED"} </b></span></big></summary>

Blah...blah...blah...

<big><b>Question No. 4</b></big>
<blockquote>
What labeled cities are the furthest North, South, East, and West?
</blockquote>

</details>

# The Write-Up

In the report you provide to FEMA please provide the following information:

- Total population of the impacted counties
- Total number of large cities (all in the clipped dataset)
- Which cities above 300,000 people would need response teams
  - Based on the distribution of these, would it be possible for one response team to cover multiple large cities?

When complete, send a link to your _Colab Notebook_ or word document with answers to Questions 1-4 and your completed map via email.